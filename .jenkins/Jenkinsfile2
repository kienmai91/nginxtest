


node {
  checkout scm
  stage('Package') {
      sh 'echo $PATH'
   
  }

  stage('Create Docker Image') {
   app =  docker.build("testapp:${env.BUILD_NUMBER}")
   
  }

  stage ('Run Application') {
    try {

      docker.image("testapp:${env.BUILD_NUMBER}").inside {

      sh "echo ${env.BUILD_NUMBER}"

}




    } catch (error) {
    } finally {
      // Stop and remove database container here
      //sh 'docker-compose stop db'
      echo 'build done'
    }
  }


  stage('push new image to docker hub') {
  docker.withRegistry('https://registry.hub.docker.com', 'dockerhub') {
      app.push("${env.BUILD_NUMBER}")
      app.push("latest")
	}

    }
}   





