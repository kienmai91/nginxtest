node {
  checkout scm
  stage('Package') {
      sh 'echo $PATH'
   
  }

  stage('Create Docker Image') {
      docker.build("testapp:${env.BUILD_NUMBER}")
   
  }

  stage ('Run Application') {
    try {

      docker.image("testapp:${env.BUILD_NUMBER}").inside {

      sh "echo ${env.BUILD_NUMBER}"

}




    } catch (error) {
    } finally {
      // Stop and remove database container here
      //sh 'docker-compose stop db'
      echo 'build done'
    }
  }
  stage('Run Application') {
    sh("docker rm -f nginx ||:")
    sh("docker run --name nginx -d -p 8081:80 testapp:${env.BUILD_NUMBER} ||:") 
  }
  stage('Trigger test') {
  try {
        build(job: 'project2', wait: false)
           }
  catch(err) { echo $err}
      
  finally { echo Done}
}
}
